<!DOCTYPE html>
<!--
[COMMENT START]
Event Planner Pro – Single-file HTML App
Ready for GitHub Pages

How to deploy (GitHub Pages):
1) Create a repo, add this file as `index.html` at the repo root.
2) (Recommended) Add a minimal `404.html` with this content to support SPA routing if you later switch to non-hash routes:
   <!DOCTYPE html><meta charset="utf-8"><script>location.href='/'</script>
3) Enable GitHub Pages on the repo (Settings → Pages → Source: "Deploy from a branch" → branch "main"/"/" root).
4) Open: https://<your-username>.github.io/<repo>/#/dashboard (hash routes required).
5) Maps load from Leaflet CDN (allowed). Everything else is offline-ready after first load.

Perf notes:
• One-file SPA with hash routing for instant navigation; no render-blocking fonts/frameworks.
• Modular JS (≤ ~60 lines per function) with batched DOM updates, Fragment insertion, and minimal reflow.
• Tables lazy-render in chunks with “Show more”.
• Icons via inline SVG sprite (no HTTP requests).
• Data stored in localStorage; autosave. Optional SW via Blob registration to cache this file (graceful fallback).
• Accessible: WCAG 2.2 AA focus rings, ARIA landmarks/roles/labels, keyboard shortcuts & skip links, semantic tables, high contrast, print styles.

[COMMENT END]
-->
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>Event Planner Pro — Single-file (Hash Routing, Offline, A11y)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <!-- Leaflet (maps allowed to use CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      --bg:#F6F3FF; --overlay: radial-gradient(900px 500px at -150px -200px,#d8ccff55,transparent 60%), radial-gradient(1000px 600px at 120% -100px,#e9e2ff66,transparent 60%), #F6F3FF;
      --panel:#fff; --card:#FCFAFF; --border:#E4DDF8; --text:#1f1b2e; --muted:#524a79;
      --accent:#7c3aed; --accent-2:#5b21b6; --accent-3:#a78bfa;
      --success:#059669; --warning:#d97706; --danger:#dc2626;
      --table-odd:#F3EEFF; --shadow:0 8px 28px rgba(72,50,154,.08); --glass:rgba(255,255,255,.75);
      --focus:#7c3aed66; --pill:#efeaff; --popover:#fff; --popover-border:#dcd3fb;
      --kbd:#111; --kbd-bg:#fff; --ring: 0 0 0 3px var(--focus);
    }
    [data-theme="dark"]{
      --bg:#161226; --overlay: radial-gradient(900px 500px at -150px -200px,#7c3aed22,transparent 60%), radial-gradient(1000px 600px at 120% -100px,#a78bfa1a,transparent 60%), #161226;
      --panel:#1c1533; --card:#1b1437; --border:#3f3cbb; --text:#f5f3ff; --muted:#d6d3ef;
      --accent:#a78bfa; --accent-2:#7c3aed; --accent-3:#c4b5fd;
      --success:#34d399; --warning:#f59e0b; --danger:#ef4444;
      --table-odd:#211a4b; --shadow:0 8px 28px rgba(0,0,0,.45); --glass:rgba(29,23,57,.75);
      --focus:#7c3aed55; --pill:#241d50; --popover:#1c1637; --popover-border:#4b3bb0;
      --kbd:#fff; --kbd-bg:#000;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--overlay);color:var(--text);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans";
      line-height:1.45; letter-spacing:.2px;
    }
    :focus-visible{outline:2px solid var(--accent-3); box-shadow:var(--ring); border-radius:6px}
    a.skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    a.skip:focus{left:8px;top:8px;width:auto;height:auto;background:#fff;color:#000;padding:8px 10px;border-radius:8px;z-index:1000}

    header{position:sticky;top:0;z-index:40;backdrop-filter:blur(10px);background:var(--glass);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;justify-content:space-between;padding:12px 16px}
    header h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.4px}
    nav[role="navigation"]{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{background:#fff;color:var(--text);border:1px solid var(--border);padding:8px 12px;font-size:13px;border-radius:12px;cursor:pointer;box-shadow:0 1px 0 #00000010,inset 0 0 0 1px #ffffff66;transition:transform .06s,box-shadow .12s,border-color .12s,background .12s}
    [data-theme="dark"] .tab-btn{background:#1c1637;box-shadow:inset 0 0 0 1px #ffffff10,0 1px 0 #00000050}
    .tab-btn:hover{border-color:var(--accent-3);box-shadow:0 4px 14px rgba(124,58,237,.2);transform:translateY(-1px)}
    .tab-btn[aria-current="page"]{background:#f0eaff;border-color:var(--accent)}
    [data-theme="dark"] .tab-btn[aria-current="page"]{background:#251c4f}

    .theme-toggle{display:inline-flex;gap:10px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:6px 12px;background:#fff;cursor:pointer}
    [data-theme="dark"] .theme-toggle{background:#1c1637}
    .theme-toggle .label{font-size:12px;color:var(--muted)}
    .icon{width:18px;height:18px;display:inline-block}

    main{padding:18px;max-width:1320px;margin:0 auto 56px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .grid{display:grid;gap:12px}
    .grid.kpi{grid-template-columns:repeat(4,minmax(0,1fr))}
    @media(max-width:1000px){.grid.kpi{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:620px){.grid.kpi{grid-template-columns:1fr}}
    .card h3{margin:0 0 6px;font-size:14px;color:var(--muted);font-weight:700}
    .kpi .value{font-size:34px;font-weight:900;margin-top:6px;color:var(--accent-2);text-shadow:0 0 8px #7c3aed18}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .spacer{flex:1}
    .two{display:grid;grid-template-columns:1.6fr 1.4fr;gap:12px}
    @media(max-width:1100px){.two{grid-template-columns:1fr}}

    input,select,textarea,button{background:#fff;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:9px 12px;font-size:14px;box-shadow:inset 0 0 0 1px #ffffffcc}
    [data-theme="dark"] input,[data-theme="dark"] select,[data-theme="dark"] textarea,[data-theme="dark"] button{background:#1a1538;box-shadow:inset 0 0 0 1px #ffffff10;color:var(--text)}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent-3);box-shadow:0 0 0 3px var(--focus),inset 0 0 0 1px #ffffff80}
    textarea{min-height:100px}
    button.primary{background:linear-gradient(180deg,#9f7aea,#7c3aed);color:#fff;border-color:var(--accent)}
    button.primary:hover{box-shadow:0 6px 20px rgba(124,58,237,.35)}
    button.ghost{background:#f8f6ff}[data-theme="dark"] button.ghost{background:#1a1530}
    button.success{background:linear-gradient(180deg,#10b981,#059669);color:#fff;border-color:#10b981}
    button.danger{background:linear-gradient(180deg,#ef4444,#b91c1c);color:#fff;border-color:#ef4444}
    button.link{background:transparent;border-color:transparent;text-decoration:underline;cursor:pointer;padding:4px 6px;border-radius:8px}

    .table-wrap{overflow:auto;border-radius:12px;border:1px solid var(--border)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:13px;vertical-align:top}
    th{text-align:left;color:var(--muted);background:#f5f0ff;position:sticky;top:0;z-index:1}
    [data-theme="dark"] th{background:#1a163b;color:#d6d3ef}
    tbody tr:nth-child(odd) td{background:var(--table-odd)}
    [data-theme="dark"] tr:hover td{background:#211a4b}
    tr:hover td{background:#efe8ff}

    .status{padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);white-space:nowrap}
    .s-planning{background:#ede9fe;color:#5b21b6}
    .s-executing{background:#e0e7ff;color:#3730a3}
    .s-completed{background:#e6f9f2;color:#065f46;border-color:#10b98166}
    .s-overdue{background:#fee2e2;color:#991b1b;border-color:#ef444466}
    [data-theme="dark"] .s-planning{background:#291f5f;color:#c4b5fd}
    [data-theme="dark"] .s-executing{background:#1f215f;color:#a5b4fc}
    [data-theme="dark"] .s-completed{background:#1c2f2a;color:#86efac}
    [data-theme="dark"] .s-overdue{background:#3a1820;color:#fecaca}

    .pill{padding:3px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;background:var(--pill);color:var(--text)}
    .muted{color:var(--muted)} .hr{height:1px;background:var(--border);margin:12px 0}
    .map{height:440px;border-radius:12px;border:1px solid var(--border);overflow:hidden}

    .autocomplete-wrap{position:relative}
    .autocomplete-list{position:absolute;top:100%;left:0;right:0;z-index:30;background:var(--popover);border:1px solid var(--popover-border);border-radius:12px;margin-top:6px;box-shadow:var(--shadow);max-height:260px;overflow:auto}
    .autocomplete-item{padding:10px 12px;cursor:pointer;border-bottom:1px solid var(--border);font-size:13px}
    .autocomplete-item:last-child{border-bottom:0}
    .autocomplete-item:hover,.autocomplete-item.active{background:#efe8ff}
    [data-theme="dark"] .autocomplete-item:hover,[data-theme="dark"] .autocomplete-item.active{background:#211a4b}

    /* Kanban */
    .kanban{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .col{background:var(--card);border:1px dashed var(--border);border-radius:12px;padding:10px;min-height:220px}
    .ticket{background:#fff;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px;margin:6px 0;box-shadow:0 1px 0 #00000010}
    [data-theme="dark"] .ticket{background:#221a46}
    .ticket.overdue{border-color:#ef4444}
    .ticket .meta{font-size:12px;color:var(--muted)}

    /* Keyboard shortcut badge */
    kbd{border:1px solid #999;border-bottom-width:2px;padding:1px 6px;border-radius:6px;background:var(--kbd-bg);color:var(--kbd);font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

    /* Print */
    @media print{
      @page{margin:12mm}
      header, .no-print, #settings, #dashboard, #events, #tasks, #budget, #map {display:none !important}
      #timeline, #vendors {display:block !important}
      body{background:#fff}
      .card{box-shadow:none;border:0;padding:0}
      .table-wrap{border:0;overflow:visible}
      th{position:static}
    }
  </style>
</head>
<body>
<a class="skip" href="#main" data-testid="skip-link">Skip to content</a>

<!-- Inline SVG sprite -->
<svg width="0" height="0" style="position:absolute;left:-9999px;overflow:hidden" aria-hidden="true" focusable="false">
  <symbol id="ic-sun" viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.8 1.8-1.8zm10.48 0l1.8-1.79 1.79 1.79-1.79 1.8-1.8-1.8zM12 4V1h-0v3h0zm0 19v-3h0v3h0zM4 12H1v0h3v0zm19 0h-3v0h3v0zM6.76 19.16l-1.8 1.79-1.79-1.79 1.79-1.8 1.8 1.8zm10.48 0l1.8 1.79 1.79-1.79-1.79-1.8-1.8 1.8zM12 7a5 5 0 100 10 5 5 0 000-10z"/></symbol>
  <symbol id="ic-moon" viewBox="0 0 24 24"><path d="M12.74 2a9 9 0 109.26 11.45A7.5 7.5 0 0112.74 2z"/></symbol>
  <symbol id="ic-plus" viewBox="0 0 24 24"><path d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></symbol>
  <symbol id="ic-edit" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 000-1.41l-2.34-2.34a1 1 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></symbol>
  <symbol id="ic-trash" viewBox="0 0 24 24"><path d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2z"/></symbol>
  <symbol id="ic-check" viewBox="0 0 24 24"><path d="M9 16.2l-3.5-3.5L4 14.2 9 19l12-12-1.5-1.5z"/></symbol>
  <symbol id="ic-download" viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zm7-18l-5 5h3v6h4V7h3l-5-5z"/></symbol>
  <symbol id="ic-upload" viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM7 10h3v6h4v-6h3l-5-5-5 5z"/></symbol>
  <symbol id="ic-refresh" viewBox="0 0 24 24"><path d="M17.65 6.35A7.95 7.95 0 0012 4V1L7 6l5 5V7a5 5 0 11-4.9 6H5a7 7 0 107.65-6.65z"/></symbol>
  <symbol id="ic-funnel" viewBox="0 0 24 24"><path d="M3 5h18l-7 8v6l-4-2v-4L3 5z"/></symbol>
  <symbol id="ic-pin" viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"/></symbol>
  <symbol id="ic-save" viewBox="0 0 24 24"><path d="M17 3H5a2 2 0 00-2 2v14l4-4h10a2 2 0 002-2V5a2 2 0 00-2-2zM7 7h8v2H7V7z"/></symbol>
  <symbol id="ic-calendar" viewBox="0 0 24 24"><path d="M7 2h2v2h6V2h2v2h3v18H4V4h3V2zm13 8H4v10h16V10z"/></symbol>
  <symbol id="ic-map" viewBox="0 0 24 24"><path d="M15 4l-6 2-6-2v16l6 2 6-2 6 2V6l-6-2zM9 20l-4-1.33V5.33L9 6.67V20zm6 0l-4-1.33V6.67L15 5.33V20zm2-13.33l2 0.67v13.34l-2-0.67V6.67z"/></symbol>
</svg>

<header role="banner" aria-label="Application header">
  <h1 id="appTitle">Event Planner Pro</h1>
  <nav role="navigation" aria-label="Primary">
    <button class="tab-btn" data-testid="nav-dashboard" data-route="#/dashboard" aria-current="page">Dashboard</button>
    <button class="tab-btn" data-testid="nav-events" data-route="#/events">Events</button>
    <button class="tab-btn" data-testid="nav-timeline" data-route="#/timeline">Timeline</button>
    <button class="tab-btn" data-testid="nav-vendors" data-route="#/vendors">Vendors</button>
    <button class="tab-btn" data-testid="nav-budget" data-route="#/budget">Budget</button>
    <button class="tab-btn" data-testid="nav-tasks" data-route="#/tasks">Tasks</button>
    <button class="tab-btn" data-testid="nav-map" data-route="#/map" aria-controls="map">Map</button>
    <button class="tab-btn" data-testid="nav-settings" data-route="#/settings">Settings</button>
  </nav>
  <button id="themeToggle" class="theme-toggle" title="Toggle theme" aria-pressed="false" data-testid="theme-toggle">
    <svg class="icon" id="themeIcon" aria-hidden="true"><use href="#ic-sun"></use></svg>
    <span id="themeLabel" class="label">Light</span>
  </button>
</header>

<main id="main" tabindex="-1">
  <!-- DASHBOARD -->
  <section id="dashboard" class="tab card" role="region" aria-labelledby="h-dashboard">
    <h2 id="h-dashboard" class="visually-hidden" style="position:absolute;left:-9999px">Dashboard</h2>
    <div class="grid kpi" aria-live="polite">
      <div class="card kpi" role="group" aria-label="Upcoming events">
        <h3>Upcoming Events</h3><div class="value" id="kpiUpcoming">0</div>
      </div>
      <div class="card kpi" role="group" aria-label="Tasks completion">
        <h3>Tasks Completion %</h3><div class="value" id="kpiCompletion">0%</div>
      </div>
      <div class="card kpi" role="group" aria-label="Overdue tasks">
        <h3>Overdue Tasks</h3><div class="value" id="kpiOverdue">0</div>
      </div>
      <div class="card kpi" role="group" aria-label="Average rating">
        <h3>Average Rating</h3><div class="value" id="kpiRating">0.00</div>
      </div>
    </div>

    <div class="hr"></div>
    <div class="two">
      <div class="card">
        <div class="row">
          <h3>Active Tasks</h3><div class="spacer"></div>
          <div class="small">Overdue / In Progress / Completed</div>
        </div>
        <div class="table-wrap" role="region" aria-label="Dashboard tasks">
          <table id="tblDashTasks">
            <thead><tr>
              <th scope="col">Task</th><th scope="col">Event</th><th scope="col">Assigned</th><th scope="col">Due</th><th scope="col">Status</th><th scope="col" class="no-print">Actions</th>
            </tr></thead><tbody></tbody>
          </table>
        </div>
      </div>
      <div class="card">
        <div class="row"><h3>Filters</h3><div class="spacer"></div>
          <button class="ghost" id="btnClearFilters" data-testid="filters-clear" aria-label="Clear filters"><svg class="icon"><use href="#ic-funnel"></use></svg> Clear</button>
        </div>
        <div class="grid" style="grid-template-columns: repeat(2,1fr); gap:8px;">
          <div><div class="small">Search</div><input id="fSearch" placeholder="Search event/task…" data-testid="filter-search" aria-label="Search"/></div>
          <div><div class="small">Event Type</div>
            <select id="fType" data-testid="filter-type" aria-label="Filter by event type"><option value="">All</option><option>Wedding</option><option>Baptism</option><option>Party</option></select>
          </div>
          <div><div class="small">Status</div>
            <select id="fStatus" data-testid="filter-status" aria-label="Filter by event status"><option value="">All</option><option>Planning</option><option>Executing</option><option>Completed</option></select>
          </div>
          <div><div class="small">Date From</div><input id="fFrom" type="date" data-testid="filter-from" aria-label="Date from"></div>
          <div><div class="small">Date To</div><input id="fTo" type="date" data-testid="filter-to" aria-label="Date to"></div>
        </div>
        <div class="small muted">Pinned deadlines appear in Tasks & Dashboard when within 7 days.</div>
      </div>
    </div>

    <div class="hr"></div>
    <div class="card">
      <div class="row"><h3 id="h-upcoming">Upcoming Events (filtered)</h3><div class="spacer"></div></div>
      <div class="table-wrap" role="region" aria-labelledby="h-upcoming">
        <table id="tblDashEvents">
          <thead><tr><th scope="col">Event</th><th scope="col">Type</th><th scope="col">Date</th><th scope="col">Address</th><th scope="col">Status</th><th scope="col">Owner</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- EVENTS -->
  <section id="events" class="tab card" role="region" aria-labelledby="h-events" hidden>
    <div class="row"><h3 id="h-events">Events</h3><div class="spacer"></div>
      <button class="primary" id="btnAddEvent" data-testid="add-event"><svg class="icon"><use href="#ic-plus"></use></svg> Add Event</button>
    </div>
    <div class="table-wrap" role="region" aria-label="Events table">
      <table id="tblEvents"><thead><tr>
        <th scope="col">Title</th><th scope="col">Type</th><th scope="col">Date</th><th scope="col">Address</th><th scope="col">Status</th><th scope="col">Owner</th><th scope="col">Lat</th><th scope="col">Lon</th><th scope="col" class="no-print">Actions</th>
      </tr></thead><tbody></tbody></table>
    </div>

    <div class="hr"></div>
    <h3>Event Form</h3>
    <form class="grid" style="grid-template-columns: repeat(4,1fr); gap:8px;" aria-label="Event form" onsubmit="return false;">
      <input id="eId" type="hidden" data-testid="event-id">
      <div><div class="small">Title*</div><input id="eTitle" placeholder="e.g., García Baptism" required data-testid="event-title"/></div>
      <div><div class="small">Type*</div>
        <select id="eType" required data-testid="event-type"><option>Wedding</option><option>Baptism</option><option>Party</option></select>
      </div>
      <div><div class="small">Date*</div><input id="eDate" type="date" required data-testid="event-date/></div>
      <div><div class="small">Status*</div>
        <select id="eStatus" required data-testid="event-status"><option>Planning</option><option>Executing</option><option>Completed</option></select>
      </div>

      <div class="autocomplete-wrap" style="grid-column: 1 / span 2;">
        <div class="small">Address* (type to search)</div>
        <input id="eAddress" placeholder="Start typing an address…" autocomplete="off" data-testid="event-address" aria-autocomplete="list" aria-controls="addrList" aria-expanded="false"/>
        <div id="addrList" class="autocomplete-list" role="listbox" style="display:none;"></div>
      </div>

      <div><div class="small">Owner</div><input id="eOwner" placeholder="owner@yourorg.com" data-testid="event-owner"/></div>
      <div><div class="small">Latitude</div><input id="eLat" type="number" step="any" placeholder="auto from address" data-testid="event-lat"/></div>
      <div><div class="small">Longitude</div><input id="eLon" type="number" step="any" placeholder="auto from address" data-testid="event-lon"/></div>
    </form>
    <div class="row" style="margin-top:10px;">
      <button class="success" id="btnSaveEvent" data-testid="save-event"><svg class="icon"><use href="#ic-save"></use></svg> Save</button>
      <button class="ghost" id="btnResetEvent" data-testid="reset-event"><svg class="icon"><use href="#ic-refresh"></use></svg> Reset</button>
    </div>
    <div class="small muted" style="margin-top:6px;">Address search by OpenStreetMap Nominatim. Select a suggestion to enable saving.</div>
  </section>

  <!-- TIMELINE -->
  <section id="timeline" class="tab card" role="region" aria-labelledby="h-timeline" hidden>
    <div class="row"><h3 id="h-timeline">Timeline / Run-of-Show</h3><div class="spacer"></div>
      <button class="primary" id="btnAddSlot" data-testid="add-slot"><svg class="icon"><use href="#ic-plus"></use></svg> Add Slot</button>
      <button class="ghost no-print" id="btnPrintTimeline" data-testid="print-timeline" title="Print timeline"><svg class="icon"><use href="#ic-download"></use></svg> Print</button>
    </div>
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px">
      <div class="card">
        <div class="row"><h3>Slots</h3><div class="spacer"></div></div>
        <div class="table-wrap" role="region" aria-label="Timeline slots">
          <table id="tblTimeline">
            <thead><tr>
              <th scope="col">Event</th><th scope="col">Title</th><th scope="col">Location/Lane</th><th scope="col">Start</th><th scope="col">End</th><th scope="col">Notes</th><th scope="col" class="no-print">Actions</th>
            </tr></thead><tbody></tbody>
          </table>
        </div>
      </div>
      <div class="card">
        <div class="row"><h3>Slot Editor</h3><div class="spacer"></div></div>
        <form id="slotForm" class="grid" style="grid-template-columns: repeat(2,1fr); gap:8px;" onsubmit="return false;">
          <input id="sId" type="hidden" data-testid="slot-id">
          <div><div class="small">Event*</div><select id="sEvent" required data-testid="slot-event"></select></div>
          <div><div class="small">Title*</div><input id="sTitle" required data-testid="slot-title"/></div>
          <div><div class="small">Lane (Location)</div><input id="sLane" placeholder="e.g., Ceremony Hall" data-testid="slot-lane"/></div>
          <div><div class="small">Start*</div><input id="sStart" type="datetime-local" required data-testid="slot-start"/></div>
          <div><div class="small">End*</div><input id="sEnd" type="datetime-local" required data-testid="slot-end"/></div>
          <div style="grid-column:1/-1"><div class="small">Notes</div><textarea id="sNotes" data-testid="slot-notes"></textarea></div>
        </form>
        <div class="row">
          <button class="success" id="btnSaveSlot" data-testid="save-slot"><svg class="icon"><use href="#ic-save"></use></svg> Save Slot</button>
          <button class="ghost" id="btnResetSlot" data-testid="reset-slot"><svg class="icon"><use href="#ic-refresh"></use></svg> Reset</button>
        </div>
        <div id="slotConflicts" class="small muted" aria-live="polite" style="margin-top:6px"></div>
      </div>
    </div>
  </section>

  <!-- VENDORS -->
  <section id="vendors" class="tab card" role="region" aria-labelledby="h-vendors" hidden>
    <div class="row"><h3 id="h-vendors">Vendors</h3><div class="spacer"></div>
      <button class="primary" id="btnAddVendor" data-testid="add-vendor"><svg class="icon"><use href="#ic-plus"></use></svg> Add Vendor</button>
      <button class="ghost no-print" id="btnPrintVendors" data-testid="print-vendors"><svg class="icon"><use href="#ic-download"></use></svg> Print</button>
    </div>
    <div class="table-wrap" role="region" aria-label="Vendor sheet">
      <table id="tblVendors">
        <thead><tr>
          <th scope="col">Name</th><th scope="col">Company</th><th scope="col">Role</th><th scope="col">Email</th><th scope="col">Phone</th><th scope="col">Contract</th><th scope="col">Payment</th><th scope="col">Docs</th><th scope="col" class="no-print">Actions</th>
        </tr></thead><tbody></tbody>
      </table>
    </div>

    <div class="hr"></div>
    <h3>Vendor Form</h3>
    <form class="grid" style="grid-template-columns: repeat(4,1fr); gap:8px;" onsubmit="return false;">
      <input id="vId" type="hidden" data-testid="vendor-id">
      <div><div class="small">Name*</div><input id="vName" required data-testid="vendor-name"/></div>
      <div><div class="small">Company</div><input id="vCompany" data-testid="vendor-company" placeholder="Company name"/></div>
      <div><div class="small">Email</div><input id="vEmail" type="email" data-testid="vendor-email" placeholder="vendor@email.com"/></div>
      <div><div class="small">Phone</div><input id="vPhone" type="tel" data-testid="vendor-phone" placeholder="+52 55 0000 0000"/></div>
      <div><div class="small">Category</div>
        <select id="vCategory" data-testid="vendor-category">
          <option>Venue</option>
          <option>Catering</option>
          <option>Photography</option>
          <option>Decoration</option>
          <option>Music</option>
          <option>Other</option>
        </select>
      </div>
      <div><div class="small">Contract Status</div>
        <select id="vContract" data-testid="vendor-contract">
          <option>Pending</option>
          <option>Signed</option>
          <option>Paid</option>
          <option>Overdue</option>
        </select>
      </div>
      <div><div class="small">Payment</div>
        <select id="vPayment" data-testid="vendor-payment">
          <option>Unpaid</option>
          <option>Deposit</option>
          <option>Paid</option>
          <option>Overdue</option>
        </select>
      </div>
      <div style="grid-column:1/-1;">
        <div class="small">Notes</div>
        <textarea id="vNotes" data-testid="vendor-notes" placeholder="Add any vendor notes or details…"></textarea>
      </div>
    </form>
    <div class="row" style="margin-top:10px;">
      <button class="success" id="btnSaveVendor" data-testid="save-vendor"><i class="ph ph-floppy-disk"></i> Save</button>
      <button class="ghost" id="btnResetVendor" data-testid="reset-vendor"><i class="ph ph-arrow-counter-clockwise"></i> Reset</button>
    </div>
  </section>

  <!-- BUDGET -->
  <section id="budget" class="tab card" style="display:none;" role="tabpanel" aria-labelledby="tab-budget">
    <div class="row">
      <h3>Budget Tracker</h3>
      <div class="spacer"></div>
      <button class="primary" id="btnAddBudget" data-testid="add-budget"><i class="ph ph-plus"></i> Add Item</button>
      <button class="ghost" id="btnExportCSV" data-testid="export-csv"><i class="ph ph-download"></i> Export CSV</button>
    </div>
    <div class="table-wrap">
      <table id="tblBudget" aria-label="Budget items">
        <thead>
          <tr><th>Category</th><th>Description</th><th>Forecast</th><th>Actual</th><th>Variance</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="hr"></div>
    <h3>Budget Item Form</h3>
    <form class="grid" style="grid-template-columns: repeat(4,1fr); gap:8px;" onsubmit="return false;">
      <input id="bId" type="hidden" data-testid="budget-id">
      <div><div class="small">Category*</div><input id="bCategory" required data-testid="budget-category"/></div>
      <div><div class="small">Description*</div><input id="bDesc" required data-testid="budget-desc"/></div>
      <div><div class="small">Forecast (MXN)</div><input id="bForecast" type="number" step="0.01" data-testid="budget-forecast"/></div>
      <div><div class="small">Actual (MXN)</div><input id="bActual" type="number" step="0.01" data-testid="budget-actual"/></div>
      <div><div class="small">Status</div>
        <select id="bStatus" data-testid="budget-status">
          <option>Planned</option>
          <option>Committed</option>
          <option>Paid</option>
        </select>
      </div>
    </form>
    <div class="row" style="margin-top:10px;">
      <button class="success" id="btnSaveBudget" data-testid="save-budget"><i class="ph ph-floppy-disk"></i> Save</button>
      <button class="ghost" id="btnResetBudget" data-testid="reset-budget"><i class="ph ph-arrow-counter-clockwise"></i> Reset</button>
    </div>
  </section>

  <!-- MAP -->
  <section id="map" class="tab card" style="display:none;" role="tabpanel" aria-labelledby="tab-map">
    <div class="row">
      <h3>Interactive Map</h3>
      <div class="spacer"></div>
      <div class="small">View all event locations and POIs.</div>
    </div>
    <div id="leafletMap" class="map" data-testid="map-view"></div>
  </section>
</main>

<script>
/* ---- Storage, CRUD, and Routing continued ---- */
const vendors = [];
const budgets = [];

function renderVendors() {
  const tbody=document.querySelector("#tblVendors tbody");
  tbody.innerHTML="";
  vendors.forEach(v=>{
    const tr=document.createElement("tr");
    tr.innerHTML=\`
      <td>\${v.name}</td>
      <td>\${v.company||""}</td>
      <td>\${v.email||""}</td>
      <td>\${v.phone||""}</td>
      <td><span class="pill">\${v.category||""}</span></td>
      <td><span class="status">\${v.contract||""}</span></td>
      <td><span class="status">\${v.payment||""}</span></td>
      <td class="row">
        <button class="ghost" onclick="editVendor('\${v.id}')"><i class="ph ph-pencil"></i></button>
        <button class="danger" onclick="deleteVendor('\${v.id}')"><i class="ph ph-trash"></i></button>
      </td>\`;
    tbody.appendChild(tr);
  });
}

function renderBudget() {
  const tbody=document.querySelector("#tblBudget tbody");
  tbody.innerHTML="";
  budgets.forEach(b=>{
    const variance=(b.actual||0)-(b.forecast||0);
    const tr=document.createElement("tr");
    tr.innerHTML=\`
      <td>\${b.category}</td>
      <td>\${b.desc}</td>
      <td>\${Number(b.forecast||0).toFixed(2)}</td>
      <td>\${Number(b.actual||0).toFixed(2)}</td>
      <td>\${variance.toFixed(2)}</td>
      <td>\${b.status}</td>
      <td class="row">
        <button class="ghost" onclick="editBudget('\${b.id}')"><i class="ph ph-pencil"></i></button>
        <button class="danger" onclick="deleteBudget('\${b.id}')"><i class="ph ph-trash"></i></button>
      </td>\`;
    tbody.appendChild(tr);
  });
}

function exportBudgetCSV(){
  let csv="Category,Description,Forecast,Actual,Variance,Status\\n";
  budgets.forEach(b=>{
    const variance=(b.actual||0)-(b.forecast||0);
    csv+=\`\${b.category},\${b.desc},\${b.forecast},\${b.actual},\${variance},\${b.status}\\n\`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="budget_export.csv";
  a.click();
}

document.getElementById("btnExportCSV").addEventListener("click", exportBudgetCSV);
</script>
</body>
</html>

